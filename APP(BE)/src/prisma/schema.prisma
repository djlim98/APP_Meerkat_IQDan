// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mysql"
  url      = "mysql://root:password@localhost:3307/dev"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId          Int          @id @default(autoincrement())
  uid             String          @unique
  password        String 
  name            String
  serviceNumber   String          @unique
  affiliatedUnit  String?
  militaryRank    String?
  image           String?
  enlistmentDate  DateTime?

  chatrooms       UsersOnChatrooms[]

  messages        Message[]

  followedBy      Friends[]       @relation("following")
  following       Friends[]       @relation("follower")
}

model Friends {
  follower        User            @relation("follower", fields: [followerId], references: [userId])
  followerId      Int

  following       User            @relation("following", fields: [followingId], references: [userId])
  followingId     Int

  @@id([followerId, followingId])
}

model UsersOnChatrooms{
  chatroom        Chatroom        @relation(fields: [chatroomId], references: [chatroomId])
  chatroomId      Int

  user            User            @relation(fields: [userId], references: [userId])
  userId          Int

  @@id([chatroomId, userId])
}

enum ChatroomType{
  SECRET
  AIRTIGHT
}

model Chatroom{
  chatroomId      Int          @id @default(autoincrement())
  name            String?
  type            ChatroomType    @default(SECRET)
  createDate      DateTime        @default(now())
  updateDate      DateTime?       @updatedAt

  users           UsersOnChatrooms[]

  notices         Notice[]

  messages        Message[]
}

model Notice{
  noticeId        Int          @id @default(autoincrement())
  title           String            
  content         String
  startDate       DateTime        @default(now())
  endDate         DateTime?
  category        String?

  belongChatRoom      Chatroom        @relation(fields: [belongChatRoomId], references: [chatroomId])          
  belongChatRoomId    Int
}

model Message{
  messageId           Int          @id @default(autoincrement())
  content             String
  sendTime            DateTime        @default(now())

  sender              User            @relation(fields: [senderId], references: [userId])
  senderId            Int

  belongChatRoom      Chatroom        @relation(fields: [belongChatRoomId], references: [chatroomId])          
  belongChatRoomId    Int
}